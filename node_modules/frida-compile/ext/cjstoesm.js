import e,{normalize as t}from"@frida/crosspath";import{check as r}from"@frida/reserved-words";import a from"fs";import i from"./typescript.js";const o=[".d.ts",".d.dts.map",".js.map",".ts",".tsx",".js",".jsx",".mjs",".mjs.map",".mjsx",".cjs",".cjs.map",".csjx",".d.cts",".d.cts.map",".d.mts",".d.mts.map",".json",".tsbuildinfo"];function n(e,r){return t(`${function(e){let t;for(const r of o)if(e.endsWith(r)){t=r;break}return null==t?e:e.slice(0,e.lastIndexOf(t))}(e)}${r}`)}function s(e){return!e.startsWith(".")&&!e.startsWith("/")}function l({id:t,parent:r,prioritizedExtensions:a=["",".js",".mjs",".cjs",".jsx",".ts",".mts",".cts",".tsx",".json"],fileSystem:i,resolveModule:o,resolveCache:n}){var l,c;t=e.normalize(t),null!=r&&(r=e.normalize(r));const d=function(e,t){return s(e)?e:`${null==t?"":`${t}->`}${e}`}(t,r),p=n.get(d);if(null!=p)return p;if(null!==p)if(s(t))if(null!=o)try{const e=o(t,null!=r?r:null);return n.set(d,e),e}catch(e){return void n.set(d,null)}else n.set(d,null);else{const o=e.isAbsolute(t)?e.normalize(t):e.join(null==r?"":e.dirname(r),t),s=[o,e.join(o,"index")];for(const e of s)for(const t of a){const r=`${e}${t}`;if(null!==(c=null===(l=i.safeStatSync(r))||void 0===l?void 0:l.isFile())&&void 0!==c&&c)return n.set(d,r),r}n.set(d,null)}}function c(e,t){var r,a;return t.isParenthesizedExpression(e)||t.isAsExpression(e)||(null===(r=t.isTypeAssertionExpression)||void 0===r?void 0:r.call(t,e))||(null===(a=t.isTypeAssertion)||void 0===a?void 0:a.call(t,e))||t.isNonNullExpression(e)||t.isExpressionWithTypeArguments(e)?e.expression:e}const d=new Set(["assert","assert/strict","async_hooks","buffer","child_process","cluster","console","constants","crypto","dgram","diagnostics_channel","dns","dns/promises","domain","events","fs","fs/promises","http","http2","https","inspector","module","net","os","path","path/posix","path/win32","perf_hooks","process","punycode","querystring","readline","readline/promises","repl","stream","stream/consumers","stream/promises","stream/web","string_decoder","timers","timers/promises","tls","trace_events","tty","url","util","util/types","v8","vm","worker_threads","zlib"]);function p(e){return d.has(e)}const m={assert:{namedExports:new Set([]),hasDefaultExport:!0},"assert/strict":{namedExports:new Set([]),hasDefaultExport:!0},async_hooks:{namedExports:new Set(["AsyncLocalStorage","createHook","executionAsyncId","triggerAsyncId","executionAsyncResource","asyncWrapProviders","AsyncResource"]),hasDefaultExport:!0},buffer:{namedExports:new Set(["Blob","resolveObjectURL","Buffer","SlowBuffer","transcode","kMaxLength","kStringMaxLength","btoa","atob","constants","INSPECT_MAX_BYTES"]),hasDefaultExport:!0},child_process:{namedExports:new Set(["ChildProcess","exec","execFile","execFileSync","execSync","fork","spawn","spawnSync"]),hasDefaultExport:!0},cluster:{namedExports:new Set(["isWorker","isMaster","isPrimary","Worker","workers","settings","SCHED_NONE","SCHED_RR","schedulingPolicy","setupPrimary","setupMaster","fork","disconnect"]),hasDefaultExport:!0},console:{namedExports:new Set(["log","warn","dir","time","timeEnd","timeLog","trace","assert","clear","count","countReset","group","groupEnd","table","debug","info","dirxml","error","groupCollapsed","Console","profile","profileEnd","timeStamp","context"]),hasDefaultExport:!0},constants:{namedExports:new Set(["E2BIG","EACCES","EADDRINUSE","EADDRNOTAVAIL","EAFNOSUPPORT","EAGAIN","EALREADY","EBADF","EBADMSG","EBUSY","ECANCELED","ECHILD","ECONNABORTED","ECONNREFUSED","ECONNRESET","EDEADLK","EDESTADDRREQ","EDOM","EEXIST","EFAULT","EFBIG","EHOSTUNREACH","EIDRM","EILSEQ","EINPROGRESS","EINTR","EINVAL","EIO","EISCONN","EISDIR","ELOOP","EMFILE","EMLINK","EMSGSIZE","ENAMETOOLONG","ENETDOWN","ENETRESET","ENETUNREACH","ENFILE","ENOBUFS","ENODATA","ENODEV","ENOENT","ENOEXEC","ENOLCK","ENOLINK","ENOMEM","ENOMSG","ENOPROTOOPT","ENOSPC","ENOSR","ENOSTR","ENOSYS","ENOTCONN","ENOTDIR","ENOTEMPTY","ENOTSOCK","ENOTSUP","ENOTTY","ENXIO","EOPNOTSUPP","EOVERFLOW","EPERM","EPIPE","EPROTO","EPROTONOSUPPORT","EPROTOTYPE","ERANGE","EROFS","ESPIPE","ESRCH","ETIME","ETIMEDOUT","ETXTBSY","EWOULDBLOCK","EXDEV","WSAEINTR","WSAEBADF","WSAEACCES","WSAEFAULT","WSAEINVAL","WSAEMFILE","WSAEWOULDBLOCK","WSAEINPROGRESS","WSAEALREADY","WSAENOTSOCK","WSAEDESTADDRREQ","WSAEMSGSIZE","WSAEPROTOTYPE","WSAENOPROTOOPT","WSAEPROTONOSUPPORT","WSAESOCKTNOSUPPORT","WSAEOPNOTSUPP","WSAEPFNOSUPPORT","WSAEAFNOSUPPORT","WSAEADDRINUSE","WSAEADDRNOTAVAIL","WSAENETDOWN","WSAENETUNREACH","WSAENETRESET","WSAECONNABORTED","WSAECONNRESET","WSAENOBUFS","WSAEISCONN","WSAENOTCONN","WSAESHUTDOWN","WSAETOOMANYREFS","WSAETIMEDOUT","WSAECONNREFUSED","WSAELOOP","WSAENAMETOOLONG","WSAEHOSTDOWN","WSAEHOSTUNREACH","WSAENOTEMPTY","WSAEPROCLIM","WSAEUSERS","WSAEDQUOT","WSAESTALE","WSAEREMOTE","WSASYSNOTREADY","WSAVERNOTSUPPORTED","WSANOTINITIALISED","WSAEDISCON","WSAENOMORE","WSAECANCELLED","WSAEINVALIDPROCTABLE","WSAEINVALIDPROVIDER","WSAEPROVIDERFAILEDINIT","WSASYSCALLFAILURE","WSASERVICE_NOT_FOUND","WSATYPE_NOT_FOUND","WSA_E_NO_MORE","WSA_E_CANCELLED","WSAEREFUSED","PRIORITY_LOW","PRIORITY_BELOW_NORMAL","PRIORITY_NORMAL","PRIORITY_ABOVE_NORMAL","PRIORITY_HIGH","PRIORITY_HIGHEST","SIGHUP","SIGINT","SIGILL","SIGABRT","SIGFPE","SIGKILL","SIGSEGV","SIGTERM","SIGBREAK","SIGWINCH","UV_FS_SYMLINK_DIR","UV_FS_SYMLINK_JUNCTION","O_RDONLY","O_WRONLY","O_RDWR","UV_DIRENT_UNKNOWN","UV_DIRENT_FILE","UV_DIRENT_DIR","UV_DIRENT_LINK","UV_DIRENT_FIFO","UV_DIRENT_SOCKET","UV_DIRENT_CHAR","UV_DIRENT_BLOCK","S_IFMT","S_IFREG","S_IFDIR","S_IFCHR","S_IFLNK","O_CREAT","O_EXCL","UV_FS_O_FILEMAP","O_TRUNC","O_APPEND","S_IRUSR","S_IWUSR","F_OK","R_OK","W_OK","X_OK","UV_FS_COPYFILE_EXCL","COPYFILE_EXCL","UV_FS_COPYFILE_FICLONE","COPYFILE_FICLONE","UV_FS_COPYFILE_FICLONE_FORCE","COPYFILE_FICLONE_FORCE","OPENSSL_VERSION_NUMBER","SSL_OP_ALL","SSL_OP_ALLOW_NO_DHE_KEX","SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION","SSL_OP_CIPHER_SERVER_PREFERENCE","SSL_OP_CISCO_ANYCONNECT","SSL_OP_COOKIE_EXCHANGE","SSL_OP_CRYPTOPRO_TLSEXT_BUG","SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS","SSL_OP_EPHEMERAL_RSA","SSL_OP_LEGACY_SERVER_CONNECT","SSL_OP_MICROSOFT_BIG_SSLV3_BUFFER","SSL_OP_MICROSOFT_SESS_ID_BUG","SSL_OP_MSIE_SSLV2_RSA_PADDING","SSL_OP_NETSCAPE_CA_DN_BUG","SSL_OP_NETSCAPE_CHALLENGE_BUG","SSL_OP_NETSCAPE_DEMO_CIPHER_CHANGE_BUG","SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG","SSL_OP_NO_COMPRESSION","SSL_OP_NO_ENCRYPT_THEN_MAC","SSL_OP_NO_QUERY_MTU","SSL_OP_NO_RENEGOTIATION","SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION","SSL_OP_NO_SSLv2","SSL_OP_NO_SSLv3","SSL_OP_NO_TICKET","SSL_OP_NO_TLSv1","SSL_OP_NO_TLSv1_1","SSL_OP_NO_TLSv1_2","SSL_OP_NO_TLSv1_3","SSL_OP_PKCS1_CHECK_1","SSL_OP_PKCS1_CHECK_2","SSL_OP_PRIORITIZE_CHACHA","SSL_OP_SINGLE_DH_USE","SSL_OP_SINGLE_ECDH_USE","SSL_OP_SSLEAY_080_CLIENT_DH_BUG","SSL_OP_SSLREF2_REUSE_CERT_TYPE_BUG","SSL_OP_TLS_BLOCK_PADDING_BUG","SSL_OP_TLS_D5_BUG","SSL_OP_TLS_ROLLBACK_BUG","ENGINE_METHOD_RSA","ENGINE_METHOD_DSA","ENGINE_METHOD_DH","ENGINE_METHOD_RAND","ENGINE_METHOD_EC","ENGINE_METHOD_CIPHERS","ENGINE_METHOD_DIGESTS","ENGINE_METHOD_PKEY_METHS","ENGINE_METHOD_PKEY_ASN1_METHS","ENGINE_METHOD_ALL","ENGINE_METHOD_NONE","DH_CHECK_P_NOT_SAFE_PRIME","DH_CHECK_P_NOT_PRIME","DH_UNABLE_TO_CHECK_GENERATOR","DH_NOT_SUITABLE_GENERATOR","ALPN_ENABLED","RSA_PKCS1_PADDING","RSA_NO_PADDING","RSA_PKCS1_OAEP_PADDING","RSA_X931_PADDING","RSA_PKCS1_PSS_PADDING","RSA_PSS_SALTLEN_DIGEST","RSA_PSS_SALTLEN_MAX_SIGN","RSA_PSS_SALTLEN_AUTO","defaultCoreCipherList","TLS1_VERSION","TLS1_1_VERSION","TLS1_2_VERSION","TLS1_3_VERSION","POINT_CONVERSION_COMPRESSED","POINT_CONVERSION_UNCOMPRESSED","POINT_CONVERSION_HYBRID","defaultCipherList"]),hasDefaultExport:!0},crypto:{namedExports:new Set(["checkPrime","checkPrimeSync","createCipheriv","createDecipheriv","createDiffieHellman","createDiffieHellmanGroup","createECDH","createHash","createHmac","createPrivateKey","createPublicKey","createSecretKey","createSign","createVerify","diffieHellman","generatePrime","generatePrimeSync","getCiphers","getCipherInfo","getCurves","getDiffieHellman","getHashes","hkdf","hkdfSync","pbkdf2","pbkdf2Sync","generateKeyPair","generateKeyPairSync","generateKey","generateKeySync","privateDecrypt","privateEncrypt","publicDecrypt","publicEncrypt","randomBytes","randomFill","randomFillSync","randomInt","randomUUID","scrypt","scryptSync","sign","setEngine","timingSafeEqual","getFips","setFips","verify","Certificate","Cipher","Cipheriv","Decipher","Decipheriv","DiffieHellman","DiffieHellmanGroup","ECDH","Hash","Hmac","KeyObject","Sign","Verify","X509Certificate","secureHeapUsed","constants","webcrypto","subtle","getRandomValues"]),hasDefaultExport:!0},dgram:{namedExports:new Set(["createSocket","Socket"]),hasDefaultExport:!0},diagnostics_channel:{namedExports:new Set(["channel","hasSubscribers","Channel"]),hasDefaultExport:!0},dns:{namedExports:new Set(["lookup","lookupService","Resolver","setDefaultResultOrder","setServers","ADDRCONFIG","ALL","V4MAPPED","NODATA","FORMERR","SERVFAIL","NOTFOUND","NOTIMP","REFUSED","BADQUERY","BADNAME","BADFAMILY","BADRESP","CONNREFUSED","TIMEOUT","EOF","FILE","NOMEM","DESTRUCTION","BADSTR","BADFLAGS","NONAME","BADHINTS","NOTINITIALIZED","LOADIPHLPAPI","ADDRGETNETWORKPARAMS","CANCELLED","getServers","resolve","resolve4","resolve6","resolveAny","resolveCaa","resolveCname","resolveMx","resolveNaptr","resolveNs","resolvePtr","resolveSoa","resolveSrv","resolveTxt","reverse","promises"]),hasDefaultExport:!0},"dns/promises":{namedExports:new Set(["lookup","lookupService","Resolver","getServers","resolve","resolve4","resolve6","resolveAny","resolveCaa","resolveCname","resolveMx","resolveNaptr","resolveNs","resolvePtr","resolveSoa","resolveSrv","resolveTxt","reverse","setServers","setDefaultResultOrder"]),hasDefaultExport:!0},domain:{namedExports:new Set(["Domain","createDomain","create","active"]),hasDefaultExport:!0},events:{namedExports:new Set([]),hasDefaultExport:!0},fs:{namedExports:new Set(["appendFile","appendFileSync","access","accessSync","chown","chownSync","chmod","chmodSync","close","closeSync","copyFile","copyFileSync","cp","cpSync","createReadStream","createWriteStream","exists","existsSync","fchown","fchownSync","fchmod","fchmodSync","fdatasync","fdatasyncSync","fstat","fstatSync","fsync","fsyncSync","ftruncate","ftruncateSync","futimes","futimesSync","lchown","lchownSync","lchmod","lchmodSync","link","linkSync","lstat","lstatSync","lutimes","lutimesSync","mkdir","mkdirSync","mkdtemp","mkdtempSync","open","openSync","opendir","opendirSync","readdir","readdirSync","read","readSync","readv","readvSync","readFile","readFileSync","readlink","readlinkSync","realpath","realpathSync","rename","renameSync","rm","rmSync","rmdir","rmdirSync","stat","statSync","symlink","symlinkSync","truncate","truncateSync","unwatchFile","unlink","unlinkSync","utimes","utimesSync","watch","watchFile","writeFile","writeFileSync","write","writeSync","writev","writevSync","Dir","Dirent","Stats","ReadStream","WriteStream","FileReadStream","FileWriteStream","F_OK","R_OK","W_OK","X_OK","constants","promises"]),hasDefaultExport:!0},"fs/promises":{namedExports:new Set(["access","copyFile","cp","open","opendir","rename","truncate","rm","rmdir","mkdir","readdir","readlink","symlink","lstat","stat","link","unlink","chmod","lchmod","lchown","chown","utimes","lutimes","realpath","mkdtemp","writeFile","appendFile","readFile","watch"]),hasDefaultExport:!0},http:{namedExports:new Set(["METHODS","STATUS_CODES","Agent","ClientRequest","IncomingMessage","OutgoingMessage","Server","ServerResponse","createServer","validateHeaderName","validateHeaderValue","get","request","maxHeaderSize","globalAgent"]),hasDefaultExport:!0},http2:{namedExports:new Set(["connect","constants","createServer","createSecureServer","getDefaultSettings","getPackedSettings","getUnpackedSettings","sensitiveHeaders","Http2ServerRequest","Http2ServerResponse"]),hasDefaultExport:!0},https:{namedExports:new Set(["Agent","globalAgent","Server","createServer","get","request"]),hasDefaultExport:!0},inspector:{namedExports:new Set(["open","close","url","waitForDebugger","console","Session"]),hasDefaultExport:!0},module:{namedExports:new Set([]),hasDefaultExport:!0},net:{namedExports:new Set(["BlockList","SocketAddress","connect","createConnection","createServer","isIP","isIPv4","isIPv6","Server","Socket","Stream"]),hasDefaultExport:!0},os:{namedExports:new Set(["arch","cpus","endianness","freemem","getPriority","homedir","hostname","loadavg","networkInterfaces","platform","release","setPriority","tmpdir","totalmem","type","userInfo","uptime","version","constants","EOL","devNull"]),hasDefaultExport:!0},path:{namedExports:new Set(["resolve","normalize","isAbsolute","join","relative","toNamespacedPath","dirname","basename","extname","format","parse","sep","delimiter","win32","posix"]),hasDefaultExport:!0},"path/posix":{namedExports:new Set(["resolve","normalize","isAbsolute","join","relative","toNamespacedPath","dirname","basename","extname","format","parse","sep","delimiter","win32","posix"]),hasDefaultExport:!0},"path/win32":{namedExports:new Set(["resolve","normalize","isAbsolute","join","relative","toNamespacedPath","dirname","basename","extname","format","parse","sep","delimiter","win32","posix"]),hasDefaultExport:!0},perf_hooks:{namedExports:new Set(["PerformanceEntry","PerformanceMark","PerformanceMeasure","PerformanceObserver","PerformanceObserverEntryList","PerformanceResourceTiming","monitorEventLoopDelay","createHistogram","performance","constants"]),hasDefaultExport:!0},process:{namedExports:new Set(["version","versions","arch","platform","release","moduleLoadList","binding","domain","config","dlopen","uptime","getActiveResourcesInfo","reallyExit","cpuUsage","resourceUsage","memoryUsage","kill","exit","hrtime","openStdin","allowedNodeEnvironmentFlags","assert","features","setUncaughtExceptionCaptureCallback","hasUncaughtExceptionCaptureCallback","emitWarning","nextTick","stdout","stdin","stderr","abort","umask","chdir","cwd","env","title","argv","execArgv","pid","ppid","execPath","debugPort","argv0","exitCode","report","setSourceMapsEnabled","mainModule","emit"]),hasDefaultExport:!0},punycode:{namedExports:new Set(["version","ucs2","decode","encode","toASCII","toUnicode"]),hasDefaultExport:!0},querystring:{namedExports:new Set(["unescapeBuffer","unescape","escape","stringify","encode","parse","decode"]),hasDefaultExport:!0},readline:{namedExports:new Set(["Interface","clearLine","clearScreenDown","createInterface","cursorTo","emitKeypressEvents","moveCursor","promises"]),hasDefaultExport:!0},"readline/promises":{namedExports:new Set(["Interface","Readline","createInterface"]),hasDefaultExport:!0},repl:{namedExports:new Set(["start","writer","REPLServer","REPL_MODE_SLOPPY","REPL_MODE_STRICT","Recoverable","builtinModules"]),hasDefaultExport:!0},stream:{namedExports:new Set([]),hasDefaultExport:!0},"stream/consumers":{namedExports:new Set(["arrayBuffer","blob","buffer","text","json"]),hasDefaultExport:!0},"stream/promises":{namedExports:new Set(["finished","pipeline"]),hasDefaultExport:!0},"stream/web":{namedExports:new Set(["ReadableStream","ReadableStreamDefaultReader","ReadableStreamBYOBReader","ReadableStreamBYOBRequest","ReadableByteStreamController","ReadableStreamDefaultController","TransformStream","TransformStreamDefaultController","WritableStream","WritableStreamDefaultWriter","WritableStreamDefaultController","ByteLengthQueuingStrategy","CountQueuingStrategy","TextEncoderStream","TextDecoderStream","CompressionStream","DecompressionStream"]),hasDefaultExport:!0},string_decoder:{namedExports:new Set(["StringDecoder"]),hasDefaultExport:!0},timers:{namedExports:new Set(["setTimeout","clearTimeout","setImmediate","clearImmediate","setInterval","clearInterval","active","unenroll","enroll"]),hasDefaultExport:!0},"timers/promises":{namedExports:new Set(["setTimeout","setImmediate","setInterval","scheduler"]),hasDefaultExport:!0},tls:{namedExports:new Set(["CLIENT_RENEG_LIMIT","CLIENT_RENEG_WINDOW","DEFAULT_CIPHERS","DEFAULT_ECDH_CURVE","DEFAULT_MIN_VERSION","DEFAULT_MAX_VERSION","getCiphers","rootCertificates","convertALPNProtocols","checkServerIdentity","createSecureContext","SecureContext","TLSSocket","Server","createServer","connect","createSecurePair"]),hasDefaultExport:!0},trace_events:{namedExports:new Set(["createTracing","getEnabledCategories"]),hasDefaultExport:!0},tty:{namedExports:new Set(["isatty","ReadStream","WriteStream"]),hasDefaultExport:!0},url:{namedExports:new Set(["Url","parse","resolve","resolveObject","format","URL","URLSearchParams","domainToASCII","domainToUnicode","pathToFileURL","fileURLToPath","urlToHttpOptions"]),hasDefaultExport:!0},util:{namedExports:new Set(["callbackify","debug","debuglog","deprecate","format","formatWithOptions","getSystemErrorMap","getSystemErrorName","inherits","inspect","isArray","isBoolean","isBuffer","isDeepStrictEqual","isNull","isNullOrUndefined","isNumber","isString","isSymbol","isUndefined","isRegExp","isObject","isDate","isError","isFunction","isPrimitive","log","promisify","stripVTControlCharacters","toUSVString","TextDecoder","TextEncoder","types"]),hasDefaultExport:!0},"util/types":{namedExports:new Set(["isExternal","isDate","isArgumentsObject","isBigIntObject","isBooleanObject","isNumberObject","isStringObject","isSymbolObject","isNativeError","isRegExp","isAsyncFunction","isGeneratorFunction","isGeneratorObject","isPromise","isMap","isSet","isMapIterator","isSetIterator","isWeakMap","isWeakSet","isArrayBuffer","isDataView","isSharedArrayBuffer","isProxy","isModuleNamespaceObject","isAnyArrayBuffer","isBoxedPrimitive","isArrayBufferView","isTypedArray","isUint8Array","isUint8ClampedArray","isUint16Array","isUint32Array","isInt8Array","isInt16Array","isInt32Array","isFloat32Array","isFloat64Array","isBigInt64Array","isBigUint64Array","isKeyObject","isCryptoKey"]),hasDefaultExport:!0},v8:{namedExports:new Set(["cachedDataVersionTag","getHeapSnapshot","getHeapStatistics","getHeapSpaceStatistics","getHeapCodeStatistics","setFlagsFromString","Serializer","Deserializer","DefaultSerializer","DefaultDeserializer","deserialize","takeCoverage","stopCoverage","serialize","writeHeapSnapshot","promiseHooks"]),hasDefaultExport:!0},vm:{namedExports:new Set(["Script","createContext","createScript","runInContext","runInNewContext","runInThisContext","isContext","compileFunction","measureMemory"]),hasDefaultExport:!0},worker_threads:{namedExports:new Set(["isMainThread","MessagePort","MessageChannel","markAsUntransferable","moveMessagePortToContext","receiveMessageOnPort","resourceLimits","threadId","SHARE_ENV","Worker","parentPort","workerData","BroadcastChannel","setEnvironmentData","getEnvironmentData"]),hasDefaultExport:!0},zlib:{namedExports:new Set(["Deflate","Inflate","Gzip","Gunzip","DeflateRaw","InflateRaw","Unzip","BrotliCompress","BrotliDecompress","deflate","deflateSync","gzip","gzipSync","deflateRaw","deflateRawSync","unzip","unzipSync","inflate","inflateSync","gunzip","gunzipSync","inflateRaw","inflateRawSync","brotliCompress","brotliCompressSync","brotliDecompress","brotliDecompressSync","createDeflate","createInflate","createDeflateRaw","createInflateRaw","createGzip","createGunzip","createUnzip","createBrotliCompress","createBrotliDecompress","constants","codes"]),hasDefaultExport:!0}};function u(r,{context:a,parent:i,resolvedModuleSpecifier:o}){if(""!==e.extname(r)||null==o)return r;switch(a.preserveModuleSpecifiers){case"always":return r;case"never":break;case"external":if(s(r))return r;break;case"internal":if(!s(r))return r;break;default:if(a.preserveModuleSpecifiers(r))return r}return n(function(e){const r=t(e);return r.startsWith(".")?r:r.startsWith("/")?`.${r}`:`./${r}`}(e.relative(e.dirname(i),o)),function(e){switch(e){case".ts":case".tsx":case".d.ts":case".d.mts":case".js":case".jsx":case".cjs":case".cjsx":case".cts":return".js";case".mjs":case".mts":case".mjsx":case".d.cts":return".mjs";default:return e}}(e.extname(o)))}function E(e,t,r){var a;const{typescript:i}=r,o=c(e,i);if(!i.isCallExpression(o))return{match:!1};const n=c(o.expression,i);if(!i.isIdentifier(n)||"require"!==n.text)return{match:!1};const[s]=o.arguments;if(null==s)return{match:!1};const d=i.isStringLiteralLike(s)?s.text:void 0,m=null==d?void 0:l({...r,id:d,parent:t.fileName}),E=null==m||p(m)||null===(a=r.fileSystem.safeReadFileSync(m))||void 0===a?void 0:a.toString();return null==d||null==m||null==E?{match:!0,moduleSpecifier:d,transformedModuleSpecifier:d,resolvedModuleSpecifier:void 0,resolvedModuleSpecifierText:void 0}:{match:!0,transformedModuleSpecifier:u(d,{resolvedModuleSpecifier:m,context:r,parent:t.fileName}),moduleSpecifier:d,resolvedModuleSpecifier:m,resolvedModuleSpecifierText:E}}function f(e,t,r){let a=e;for(;null!=a.parent;){if(a=a.parent,null!=r&&r(a))return;if(t(a))return a}}function S(e,t){return t.isStatementButNotDeclaration(e)}function x(e,t){return t.isDeclaration(e)}function I(e,t){return S(e,t)||x(e,t)}function N(t){const{name:r}=e.parse(t);return function(e){if(e.length<2)return e.toLowerCase();const t=e.slice(0,1),r=e.slice(1);return`${t.toLowerCase()}${r}`}(r.replace(/[-_+]+/g," ").replace(/[ ]{2,}/g," ").replace(/[^\w\sa-zæøåàáäâëêéèïîíìöòóôüúùû&]/gi,"").replace(/[A-Z]{2,}/g,(e=>e.toLowerCase())).replace(/ (.)/g,(e=>e.toUpperCase())).replace(/ /g,""))}function D(e,t){if(!e.match)return;const{typescript:r}=t,{moduleSpecifier:a,resolvedModuleSpecifierText:i,resolvedModuleSpecifier:o}=e;if(null==a)return;let n;return null==o&&p(a)?n=m[a]:null!=o&&(o.endsWith(".json")?n={assert:"json",hasDefaultExport:!0,namedExports:new Set}:(n=t.getModuleExportsForPath(o),null==n&&null!=i&&(n=t.transformSourceFile(r.createSourceFile(o,i,r.ScriptTarget.ESNext,!0,r.ScriptKind.TS),{...t,onlyExports:!0}).exports))),n}function y(e,t){return null!=e&&("boolean"==typeof e?e:null==t||("string"==typeof e?t.fileName===e:e(t.fileName)))}function O(e,t,r){if(null==r)return;const{factory:a,importAssertions:i}=e;return!1===i||"function"==typeof i&&!i(t)?void 0:("createAssertClause"in e.typescript.factory||e.logger.warn(`The current version of TypeScript (v${e.typescript.version}) does not support Import Assertions. No Import Assertion will be added for the module with specifier '${t}' in the transformed code. To remove this warning, either disable import assertions or update to TypeScript v4.5 or newer.`),a.createAssertClause(a.createNodeArray([a.createAssertEntry(a.createIdentifier("type"),a.createStringLiteral(r))])))}function _(e,t="exports",r){if(e=c(e,r),r.isIdentifier(e))return e.text===t?{}:void 0;if(r.isPropertyAccessExpression(e)){const a=c(e.expression,r),i=e.name;if(r.isIdentifier(a))return"module"===a.text&&i.text===t?{}:a.text===t?{property:i.text}:void 0;{const e=_(a,t,r);return null==e?void 0:{...e,property:i.text}}}if(r.isElementAccessExpression(e)){const a=c(e.expression,r),i=c(e.argumentExpression,r);if(!r.isStringLiteralLike(i))return;if(r.isIdentifier(a))return"module"===a.text&&i.text===t?{}:a.text===t?{property:i.text}:void 0;{const e=_(a,t,r);return null==e?void 0:{...e,property:i.text}}}}function h(e,t){return!t.isPropertyAccessExpression(e)&&("name"in e&&null!=e.name)}function A(e,t){return e.kind===t.SyntaxKind.ThisKeyword||!0===t.forEachChild(e,(e=>A(e,t)))}function v(e,t){const{factory:r,typescript:a}=t;if(null==e)e=r.createNodeArray();else if(e.some((e=>e.kind===a.SyntaxKind.ExportKeyword)))return e;return r.createNodeArray([r.createModifier(a.SyntaxKind.ExportKeyword),...e.map((e=>r.createModifier(e.kind)))])}function g(e,t){try{return t.isExpressionNode(e)||t.isIdentifier(e)}catch{return!1}}function L(e,t){if(t.isIdentifier(e))return[e.text];if(t.isObjectBindingPattern(e)){const r=[];for(const a of e.elements)r.push(...L(a.name,t));return r}{const r=[];for(const a of e.elements)t.isOmittedExpression(a)||r.push(...L(a.name,t));return r}}function C({node:e,sourceFile:t,context:r,continuation:a}){const{typescript:i,factory:o}=r,n=_(e.left,r.exportsName,i),s=c(e.right,i);if(null==n)return e;if(e.operatorToken.kind===i.SyntaxKind.EqualsToken){const l=f(e,i.isVariableDeclaration),c=null!=l?o.createIdentifier(L(l.name,i)[0]):void 0;if(null==n.property||"default"===n.property){if(i.isObjectLiteralExpression(s)){if(0===s.properties.length||null!=c){const t=a(e.right);if(null==t||Array.isArray(t)||!g(t,i))return;const n=null!=c?c:t;return r.isDefaultExported||(r.markDefaultAsExported(),r.addTrailingStatements(o.createExportAssignment(void 0,void 0,!1,n))),null!=l?e.right:void 0}const t=[];let n;const d=[];for(const e of s.properties){const a=null==e.name?void 0:i.isLiteralExpression(e.name)||i.isIdentifier(e.name)||i.isPrivateIdentifier(e.name)?e.name.text:i.isLiteralExpression(e.name.expression)?e.name.expression.text:void 0;if(null==a||i.isSetAccessorDeclaration(e)||i.isGetAccessorDeclaration(e)||r.isLocalExported(a))d.push(e);else if(i.isShorthandPropertyAssignment(e)){r.markLocalAsExported(a),d.push(o.createShorthandPropertyAssignment(a,e.objectAssignmentInitializer));const i=o.createNamedExports([o.createExportSpecifier(!1,void 0,a)]);t.push(o.createExportDeclaration(void 0,void 0,!1,i,void 0))}else if(i.isPropertyAssignment(e)&&i.isIdentifier(e.initializer)){r.markLocalAsExported(a),d.push(o.createPropertyAssignment(a,o.createIdentifier(e.initializer.text)));const i=o.createNamedExports([a===e.initializer.text?o.createExportSpecifier(!1,void 0,a):o.createExportSpecifier(!1,e.initializer.text,a)]);t.push(o.createExportDeclaration(void 0,void 0,!1,i,void 0))}else r.isIdentifierFree(a)&&i.isPropertyAssignment(e)&&!A(e.initializer,i)?(r.addLocal(a),d.push(o.createShorthandPropertyAssignment(a)),t.push(o.createVariableStatement([o.createModifier(i.SyntaxKind.ExportKeyword)],o.createVariableDeclarationList([o.createVariableDeclaration(a,void 0,void 0,e.initializer)],i.NodeFlags.Const)))):r.isIdentifierFree(a)&&i.isMethodDeclaration(e)&&i.isIdentifier(e.name)&&!A(e,i)?(r.addLocal(a),d.push(o.createShorthandPropertyAssignment(a)),t.push(o.createFunctionDeclaration(e.decorators,v(e.modifiers,r),e.asteriskToken,e.name,e.typeParameters,e.parameters,e.type,e.body))):r.isIdentifierFree(a)?(r.addLocal(a),d.push(e),null==n&&(n=r.getFreeIdentifier("moduleExports")),r.markLocalAsExported(a),t.push(o.createVariableStatement([o.createModifier(i.SyntaxKind.ExportKeyword)],o.createVariableDeclarationList([o.createVariableDeclaration(a,void 0,void 0,o.createPropertyAccessExpression(o.createIdentifier(n),a))],i.NodeFlags.Const)))):d.push(e)}if(null!=n)t.push(o.createVariableStatement(void 0,o.createVariableDeclarationList([o.createVariableDeclaration(n,void 0,void 0,o.createObjectLiteralExpression(d,!0))],i.NodeFlags.Const))),r.isDefaultExported||(t.push(o.createExportAssignment(void 0,void 0,!1,o.createIdentifier(n))),r.markDefaultAsExported());else if(!r.isDefaultExported){const e=o.createObjectLiteralExpression(d,!0);t.push(o.createExportAssignment(void 0,void 0,!1,e))}return void r.addTrailingStatements(...t)}{const n=E(e.right,t,r);if(!n.match){if(!r.isDefaultExported){r.markDefaultAsExported();const t=a(e.right);if(null==t||Array.isArray(t)||!g(t,i))return;{const e=null!=l?t:void 0,a=null!=c?c:t;return r.addTrailingStatements(o.createExportAssignment(void 0,void 0,!1,a)),e}}return}const{transformedModuleSpecifier:s}=n;if(null==s){if(y(r.debug))throw new TypeError("Could not handle re-export from require() call. The module specifier wasn't statically analyzable");return}{const e=D(n,r),t=o.createStringLiteral(s);if(r.isDefaultExported||null!=e&&!e.hasDefaultExport)return void r.addTrailingStatements(o.createExportDeclaration(void 0,void 0,!1,void 0,t));{r.markDefaultAsExported();const e=o.createNamedExports([o.createExportSpecifier(!1,void 0,"default")]);return void r.addTrailingStatements(o.createExportDeclaration(void 0,void 0,!1,e,t))}}}}if(null!=c){const t=n.property,s=a(e.right);if(null==s||Array.isArray(s)||!g(s,i)&&!i.isIdentifier(s))return;const l=o.createNamedExports([t===c.text?o.createExportSpecifier(!1,void 0,o.createIdentifier(t)):o.createExportSpecifier(!1,c.text,o.createIdentifier(t))]);return r.addTrailingStatements(o.createExportDeclaration(void 0,void 0,!1,l)),s}if(i.isIdentifier(s)){const e=n.property;if(!r.isLocalExported(e)){const t=o.createNamedExports([e===s.text?o.createExportSpecifier(!1,void 0,o.createIdentifier(e)):o.createExportSpecifier(!1,s.text,o.createIdentifier(e))]);r.markLocalAsExported(e),r.addTrailingStatements(o.createExportDeclaration(void 0,void 0,!1,t))}return}if(h(s,i)&&null!=s.name&&i.isIdentifier(s.name)&&n.property===s.name.text)return void r.addTrailingStatements(function(e,t){const r=null==e.modifiers?[]:e.modifiers.map((e=>e.kind)),{typescript:a,factory:i}=t,o=a.getNameOfDeclaration(e);if(null!=o&&a.isIdentifier(o)){if(t.isLocalExported(o.text))return e;t.markLocalAsExported(o.text)}if(r.includes(a.SyntaxKind.ExportKeyword))return e;const n=[t.factory.createModifier(a.SyntaxKind.ExportKeyword),...r.map((e=>i.createModifier(e)))];if(a.isFunctionDeclaration(e))return t.factory.updateFunctionDeclaration(e,e.decorators,n,e.asteriskToken,e.name,e.typeParameters,e.parameters,e.type,e.body);if(a.isFunctionExpression(e))return t.factory.updateFunctionExpression(e,n,e.asteriskToken,e.name,e.typeParameters,e.parameters,e.type,e.body);if(a.isClassDeclaration(e))return t.factory.updateClassDeclaration(e,e.decorators,n,e.name,e.typeParameters,e.heritageClauses,e.members);if(a.isClassExpression(e))return t.factory.updateClassExpression(e,e.decorators,n,e.name,e.typeParameters,e.heritageClauses,e.members);if(a.isVariableStatement(e))return t.factory.updateVariableStatement(e,n,e.declarationList);if(a.isEnumDeclaration(e))return t.factory.updateEnumDeclaration(e,e.decorators,n,e.name,e.members);if(a.isInterfaceDeclaration(e))return t.factory.updateInterfaceDeclaration(e,e.decorators,n,e.name,e.typeParameters,e.heritageClauses,e.members);if(a.isTypeAliasDeclaration(e))return t.factory.updateTypeAliasDeclaration(e,e.decorators,n,e.name,e.typeParameters,e.type);if(y(t.debug))throw new TypeError(`Could not handle Node of kind: ${a.SyntaxKind[e.kind]}`);return e}(s,r));{const t=a(e.right);if(null==t||Array.isArray(t))return;if(!r.isLocalExported(n.property))if(r.markLocalAsExported(n.property),i.isIdentifier(t)){const e=o.createNamedExports([t.text===n.property?o.createExportSpecifier(!1,void 0,o.createIdentifier(n.property)):o.createExportSpecifier(!1,o.createIdentifier(t.text),o.createIdentifier(n.property))]);r.addTrailingStatements(o.createExportDeclaration(void 0,void 0,!1,e,void 0))}else{const e=r.getFreeIdentifier(n.property);if(e===n.property)r.addTrailingStatements(o.createVariableStatement([o.createModifier(i.SyntaxKind.ExportKeyword)],o.createVariableDeclarationList([o.createVariableDeclaration(n.property,void 0,void 0,t)],i.NodeFlags.Const)));else{const a=o.createNamedExports([o.createExportSpecifier(!1,e,n.property)]);r.addTrailingStatements(o.createVariableStatement(void 0,o.createVariableDeclarationList([o.createVariableDeclaration(e,void 0,void 0,t)],i.NodeFlags.Const)),o.createExportDeclaration(void 0,void 0,!1,a,void 0))}}return}}return e}function T(e,t,r){const a=r.forEachChild(t,(t=>!(!r.isBinaryExpression(t)||t.operatorToken.kind!==r.SyntaxKind.EqualsToken||!r.isIdentifier(t.left)||t.left.text!==e)||(!!T(e,t,r)||void 0)));return null!=a&&a}function P(e,t){return null!=e.modifiers&&e.modifiers.some((e=>e.kind===t.SyntaxKind.ExportKeyword))}function R(e,t){return e.kind===t.SyntaxKind.NotEmittedStatement}function F(e,t,r){const a=r.forEachChild(e,(e=>!(!g(e,r)||null==_(e,t,r))||(!!F(e,t,r)||void 0)));return null!=a&&a}function M({node:e,context:t}){const{typescript:r,factory:a}=t;if(!r.isSourceFile(e))return e;const[i]=e.statements;if(!r.isExpressionStatement(i))return e;const o=c(i.expression,r);if(!r.isCallExpression(o))return e;const n=c(o.expression,r);if(!r.isFunctionExpression(n))return e;if(o.arguments.length<2)return e;let[,s]=o.arguments;if(s=c(s,r),!r.isFunctionExpression(s))return e;if(s.parameters.length<1)return e;const[l]=s.parameters;return r.isIdentifier(l.name)&&F(s.body,l.name.text,r)?(t.exportsName=l.name.text,a.updateSourceFile(e,[...s.body.statements,...e.statements.slice(1)],e.isDeclarationFile,e.referencedFiles,e.typeReferenceDirectives,e.hasNoDefaultLib,e.libReferenceDirectives)):e}function b(e){const{typescript:t}=e.context,r=M(e);return null!=r&&r!==e.node?e.childContinuation(r):t.isVariableDeclarationList(e.node)?function({node:e,childContinuation:t,context:r}){if(r.onlyExports)return t(e);const{typescript:a,factory:i}=r,o=t(e);if(null==o||Array.isArray(o)||!a.isVariableDeclarationList(o))return o;const n=o.declarations.filter((e=>!R(e,a)));return 0===n.length?o:i.updateVariableDeclarationList(e,n)}(e):t.isVariableDeclaration(e.node)?function({node:e,childContinuation:t,sourceFile:r,context:a}){var i;if(a.onlyExports||null==e.initializer)return t(e);const{typescript:o,factory:n}=a,s=c(e.initializer,o),l=f(e,o.isVariableStatement,(e=>o.isBlock(e)||o.isSourceFile(e)));if(!o.isCallExpression(s))return t(e);const d=E(s,r,a);if(!d.match)return t(e);const{moduleSpecifier:p,transformedModuleSpecifier:m}=d;if(null==p||null==m)return t(e);const u=D(d,a);if(o.isIdentifier(e.name)){if((null==u||u.hasDefaultExport)&&a.hasLocalForDefaultImportFromModule(p))return t(e);if(null!=u&&!u.hasDefaultExport&&a.hasLocalForNamespaceImportFromModule(p))return t(e);if(null!=l&&P(l,o)){const t=n.createStringLiteral(m);if(null==u||u.hasDefaultExport){const r=n.createNamedExports([n.createExportSpecifier(!1,"default"===e.name.text?void 0:n.createIdentifier("default"),n.createIdentifier(e.name.text))]);return void a.addTrailingStatements(n.createExportDeclaration(void 0,void 0,!1,r,t))}if(null!=n.createNamespaceExport){const r=n.createNamespaceExport(n.createIdentifier(e.name.text));return void a.addTrailingStatements(n.createExportDeclaration(void 0,void 0,!1,r,t))}{a.addImport(n.createImportDeclaration(void 0,void 0,n.createImportClause(!1,void 0,n.createNamespaceImport(n.createIdentifier(e.name.text))),t,O(a,m,null==u?void 0:u.assert)),p);const r=n.createNamedExports([n.createExportSpecifier(!1,void 0,n.createIdentifier(e.name.text))]);return void a.addTrailingStatements(n.createExportDeclaration(void 0,void 0,!1,r))}}{const t=T(e.name.text,r,o),i=t?a.getFreeIdentifier(e.name.text,!0):e.name.text;return a.addImport(n.createImportDeclaration(void 0,void 0,null==u||u.hasDefaultExport?n.createImportClause(!1,n.createIdentifier(i),void 0):n.createImportClause(!1,void 0,n.createNamespaceImport(n.createIdentifier(i))),n.createStringLiteral(m),O(a,m,null==u?void 0:u.assert)),p),void(t&&a.addLeadingStatements(n.createVariableStatement(void 0,n.createVariableDeclarationList([n.createVariableDeclaration(e.name.text,void 0,void 0,n.createIdentifier(i))],o.NodeFlags.Let))))}}if(null!=u&&o.isObjectBindingPattern(e.name)){const s=[];for(const r of e.name.elements)if(null==r.propertyName&&o.isIdentifier(r.name)){if(!u.namedExports.has(r.name.text))return t(e);s.push(n.createImportSpecifier(!1,void 0,n.createIdentifier(r.name.text)))}else{if(null==r.propertyName||!o.isIdentifier(r.propertyName)||!o.isIdentifier(r.name))return t(e);if(!u.namedExports.has(r.propertyName.text))return t(e);s.push(n.createImportSpecifier(!1,n.createIdentifier(r.propertyName.text),n.createIdentifier(r.name.text)))}if(s.length>0){const e=s.filter((e=>T(e.name.text,r,o))),t=s.filter((t=>!e.includes(t)));for(const t of e){const e=null!==(i=t.propertyName)&&void 0!==i?i:t.name,r=a.getFreeIdentifier(t.name.text,!0),s=n.createNamedImports([n.createImportSpecifier(!1,n.createIdentifier(e.text),n.createIdentifier(r))]);a.addImport(n.createImportDeclaration(void 0,void 0,n.createImportClause(!1,void 0,s),n.createStringLiteral(m),O(a,m,null==u?void 0:u.assert)),p),a.addLeadingStatements(n.createVariableStatement(void 0,n.createVariableDeclarationList([n.createVariableDeclaration(t.name.text,void 0,void 0,n.createIdentifier(r))],o.NodeFlags.Let)))}return void(t.length>0&&a.addImport(n.createImportDeclaration(void 0,void 0,n.createImportClause(!1,void 0,n.createNamedImports(t)),n.createStringLiteral(m),O(a,m,null==u?void 0:u.assert)),p))}}return t(e)}(e):t.isBinaryExpression(e.node)?C(e):t.isCallExpression(e.node)?function({node:e,childContinuation:t,sourceFile:r,context:a}){const{typescript:i,factory:o}=a;if("Object.defineProperty"===e.expression.getText()){const t=e.arguments;if(3===t.length){const[e,r,n]=t;if(i.isIdentifier(e)&&"module"===e.text&&i.isStringLiteral(r)&&"exports"===r.text&&i.isObjectLiteralExpression(n))for(const e of n.properties){if(!i.isPropertyAssignment(e))continue;const{name:t,initializer:r}=e;if(i.isIdentifier(t)&&i.isIdentifier(r)&&"get"===t.text)return a.markDefaultAsExported(),void a.addTrailingStatements(o.createExportAssignment(void 0,void 0,!1,o.createCallExpression(r,[],[])))}}}if(a.onlyExports)return t(e);const n=E(e,r,a);if(!n.match)return t(e);const{moduleSpecifier:s,transformedModuleSpecifier:l}=n;if(null==s||null==l)return;const d=D(n,a),p=f(e,i.isExpressionStatement,(e=>i.isBinaryExpression(e)||i.isCallExpression(e)||i.isNewExpression(e)));if(null==d||0===d.namedExports.size||null!=p&&!d.hasDefaultExport){if(null!=p)return void(a.isModuleSpecifierImportedWithoutLocals(s)||a.addImport(o.createImportDeclaration(void 0,void 0,void 0,o.createStringLiteral(l),O(a,l,null==d?void 0:d.assert)),s));if(a.hasLocalForDefaultImportFromModule(s)){const e=a.getLocalForDefaultImportFromModule(s);return o.createIdentifier(e)}{const e=o.createIdentifier(a.getFreeIdentifier(N(s))),t=o.createImportClause(!1,e,void 0);return a.addImport(o.createImportDeclaration(void 0,void 0,t,o.createStringLiteral(l),O(a,l,null==d?void 0:d.assert)),s),e}}const m=f(e,(e=>i.isElementAccessExpression(e)||i.isPropertyAccessExpression(e)),(e=>I(e,i)));if(null!=m){let e;if(i.isPropertyAccessExpression(m)?e=m.name.text:i.isStringLiteralLike(m.argumentExpression)&&(e=m.argumentExpression.text),null!=e){if(d.namedExports.has(e)){const t=e;let r;if(a.hasLocalForNamedImportPropertyNameFromModule(t,s))r=a.getLocalForNamedImportPropertyNameFromModule(t,s);else if(!d.hasDefaultExport&&a.hasLocalForNamespaceImportFromModule(s))r=a.getLocalForNamespaceImportFromModule(s);else{r=a.getFreeIdentifier(t);const e=o.createNamedImports([t===r?o.createImportSpecifier(!1,void 0,o.createIdentifier(t)):o.createImportSpecifier(!1,o.createIdentifier(t),o.createIdentifier(r))]),i=o.createImportClause(!1,void 0,e);a.addImport(o.createImportDeclaration(void 0,void 0,i,o.createStringLiteral(l),O(a,l,null==d?void 0:d.assert)),s)}if(null==p){const t=[r!==e?o.createPropertyAssignment(e,o.createIdentifier(r)):o.createShorthandPropertyAssignment(o.createIdentifier(r))];return o.createObjectLiteralExpression(t)}return}{let t;d.hasDefaultExport&&a.hasLocalForDefaultImportFromModule(s)?t=o.createIdentifier(a.getLocalForDefaultImportFromModule(s)):!d.hasDefaultExport&&a.hasLocalForNamespaceImportFromModule(s)?t=o.createIdentifier(a.getLocalForNamespaceImportFromModule(s)):(t=o.createIdentifier(a.getFreeIdentifier(N(s))),a.addImport(o.createImportDeclaration(void 0,void 0,d.hasDefaultExport?o.createImportClause(!1,t,void 0):o.createImportClause(!1,void 0,o.createNamespaceImport(t)),o.createStringLiteral(l),O(a,l,null==d?void 0:d.assert)),s));const r=[t.text!==e?o.createPropertyAssignment(e,o.createIdentifier(t.text)):o.createShorthandPropertyAssignment(o.createIdentifier(t.text))];return o.createObjectLiteralExpression(r)}}}const u=f(e,i.isVariableDeclaration,(e=>S(e,i)));if(null!=u){if(i.isIdentifier(u.name)){if(d.hasDefaultExport&&a.hasLocalForDefaultImportFromModule(s)){const e=a.getLocalForDefaultImportFromModule(s);return o.createIdentifier(e)}if(!d.hasDefaultExport&&a.hasLocalForNamespaceImportFromModule(s)){const e=a.getLocalForNamespaceImportFromModule(s);return o.createIdentifier(e)}{const e=o.createIdentifier(a.getFreeIdentifier(N(s)));return a.addImport(o.createImportDeclaration(void 0,void 0,d.hasDefaultExport?o.createImportClause(!1,e,void 0):o.createImportClause(!1,void 0,o.createNamespaceImport(e)),o.createStringLiteral(l),O(a,l,null==d?void 0:d.assert)),s),e}}if(i.isObjectBindingPattern(u.name)){const e=[],t=[];for(const r of u.name.elements)if(null==r.propertyName&&i.isIdentifier(r.name)){if(d.namedExports.has(r.name.text))if(a.hasLocalForNamedImportPropertyNameFromModule(r.name.text,s)){const e=a.getLocalForNamedImportPropertyNameFromModule(r.name.text,s);t.push(e===r.name.text?o.createImportSpecifier(!1,void 0,o.createIdentifier(e)):o.createImportSpecifier(!1,o.createIdentifier(r.name.text),o.createIdentifier(e)))}else if(a.isIdentifierFree(r.name.text))a.addLocal(r.name.text),e.push(o.createImportSpecifier(!1,void 0,o.createIdentifier(r.name.text)));else{const t=a.getFreeIdentifier(r.name.text);e.push(o.createImportSpecifier(!1,o.createIdentifier(r.name.text),o.createIdentifier(t)))}}else if(null!=r.propertyName&&i.isIdentifier(r.propertyName))if(a.isIdentifierFree(r.propertyName.text))a.addLocal(r.propertyName.text),e.push(o.createImportSpecifier(!1,void 0,o.createIdentifier(r.propertyName.text)));else{const t=a.getFreeIdentifier(r.propertyName.text);e.push(o.createImportSpecifier(!1,o.createIdentifier(r.propertyName.text),o.createIdentifier(t)))}if(e.length+t.length!==u.name.elements.length){if(d.hasDefaultExport&&a.hasLocalForDefaultImportFromModule(s)){const e=a.getLocalForDefaultImportFromModule(s);return o.createIdentifier(e)}if(!d.hasDefaultExport&&a.hasLocalForNamespaceImportFromModule(s)){const e=a.getLocalForNamespaceImportFromModule(s);return o.createIdentifier(e)}{const e=o.createIdentifier(a.getFreeIdentifier(N(s)));return a.addImport(o.createImportDeclaration(void 0,void 0,d.hasDefaultExport?o.createImportClause(!1,e,void 0):o.createImportClause(!1,void 0,o.createNamespaceImport(e)),o.createStringLiteral(l),O(a,l,null==d?void 0:d.assert)),s),e}}{e.length>0&&a.addImport(o.createImportDeclaration(void 0,void 0,o.createImportClause(!1,void 0,o.createNamedImports(e)),o.createStringLiteral(l),O(a,l,null==d?void 0:d.assert)),s);const r=[...e,...t].map((e=>null!=e.propertyName?o.createPropertyAssignment(e.propertyName.text,o.createIdentifier(e.name.text)):o.createShorthandPropertyAssignment(o.createIdentifier(e.name.text))));return o.createObjectLiteralExpression(r)}}}const x=f(e,i.isBinaryExpression,(e=>S(e,i)));if(null!=x&&x.operatorToken.kind===i.SyntaxKind.EqualsToken&&(i.isPropertyAccessExpression(c(x.left,i))||i.isElementAccessExpression(c(x.left,i)))){if(d.hasDefaultExport&&a.hasLocalForDefaultImportFromModule(s)){const e=a.getLocalForDefaultImportFromModule(s);return o.createIdentifier(e)}if(!d.hasDefaultExport&&a.hasLocalForNamespaceImportFromModule(s)){const e=a.getLocalForNamespaceImportFromModule(s);return o.createIdentifier(e)}{const e=o.createIdentifier(a.getFreeIdentifier(N(s)));return a.addImport(o.createImportDeclaration(void 0,void 0,d.hasDefaultExport?o.createImportClause(!1,e,void 0):o.createImportClause(!1,void 0,o.createNamespaceImport(e)),o.createStringLiteral(l),O(a,l,null==d?void 0:d.assert)),s),e}}if(null!=f(e,i.isCallExpression,(e=>I(e,i)))){if(d.hasDefaultExport&&a.hasLocalForDefaultImportFromModule(s)){const e=a.getLocalForDefaultImportFromModule(s);return o.createIdentifier(e)}if(!d.hasDefaultExport&&a.hasLocalForNamespaceImportFromModule(s)){const e=a.getLocalForNamespaceImportFromModule(s);return o.createIdentifier(e)}{const e=o.createIdentifier(a.getFreeIdentifier(N(s)));return a.addImport(o.createImportDeclaration(void 0,void 0,d.hasDefaultExport?o.createImportClause(!1,e,void 0):o.createImportClause(!1,void 0,o.createNamespaceImport(e)),o.createStringLiteral(l),O(a,l,null==d?void 0:d.assert)),s),e}}if(y(a.debug))throw new TypeError("Could not handle require() call");return e}(e):e.childContinuation(e.node)}function w(e,t){return null==e||(Array.isArray(e)?e.some((e=>w(e,t))):!t.isSourceFile(e)&&(!t.isBlock(e)&&(R(e,t)||Boolean(t.forEachChild(e,(e=>w(e,t)))))))}function k(e){const{typescript:t}=e.context;if(t.isImportDeclaration(e.node))return function({node:e,context:t}){t.typescript.isStringLiteralLike(e.moduleSpecifier)&&t.addImport(e,e.moduleSpecifier.text,!0)}(e);if(t.isExportDeclaration(e.node))return function({node:e,context:t}){if(null!=e.exportClause&&t.typescript.isNamedExports(e.exportClause))for(const r of e.exportClause.elements)"default"===r.name.text?t.markDefaultAsExported():t.markLocalAsExported(r.name.text)}(e);if(t.isExportAssignment(e.node))return function({context:e}){e.markDefaultAsExported()}(e);if(function(e,t){return P(e,t)&&null!=e.modifiers&&e.modifiers.some((e=>e.kind===t.SyntaxKind.DefaultKeyword))}(e.node,t))e.context.markDefaultAsExported();else if(P(e.node,t))if(x(e.node,t)){const r=t.getNameOfDeclaration(e.node);null!=r&&t.isIdentifier(r)&&e.context.markLocalAsExported(r.text)}else if(t.isVariableStatement(e.node))for(const r of e.node.declarationList.declarations)for(const a of L(r.name,t))e.context.markLocalAsExported(a);return e.childContinuation(e.node)}function U(t,a){if(!a.onlyExports&&!t.text.includes("require")&&!t.text.includes("exports"))return{sourceFile:t,exports:{namedExports:new Set,hasDefaultExport:!1}};const{typescript:i,factory:o,transformationContext:n}=a,s=(()=>{const o=new Map,n=[],s=[],l=new Map,c=t.locals,d=null==c?new Set:new Set(c.keys()),p=new Set;let m=!1;const u=e=>{d.add(e)},E=e=>{var t;return null===(t=[...o.entries()].find((([,{originalModuleSpecifier:t}])=>t===e)))||void 0===t?void 0:t[0]},f=e=>{const t=E(e);if(null!=t&&null!=t.importClause&&null!=t.importClause.name)return t.importClause.name.text},S=e=>{const t=E(e);if(null!=t&&null!=t.importClause&&null!=t.importClause.namedBindings&&i.isNamespaceImport(t.importClause.namedBindings))return t.importClause.namedBindings.name.text},x=(e,t)=>{const r=E(t);if(null!=r&&null!=r.importClause&&null!=r.importClause.namedBindings&&i.isNamedImports(r.importClause.namedBindings))for(const t of r.importClause.namedBindings.elements){if(null!=t.propertyName&&t.propertyName.text===e)return t.name.text;if(null==t.propertyName&&t.name.text===e)return t.name.text}},I=e=>!(d.has(e)||r(e,"es3",!0)||r(e,"es5",!0)||r(e,"es2015",!0));return{...a,transformSourceFile:U,exportsName:void 0,addImport:(e,t,r=!1)=>{o.set(e,{originalModuleSpecifier:t,noEmit:r})},addLocal:u,markLocalAsExported:e=>{p.add(e)},markDefaultAsExported:()=>{m=!0},isLocalExported:e=>p.has(e),isModuleSpecifierImportedWithoutLocals:e=>{const t=E(e);return null!=t&&(null==t.importClause||null==t.importClause.name&&null==t.importClause.namedBindings)},getImportDeclarationWithModuleSpecifier:E,getLocalForDefaultImportFromModule:f,hasLocalForDefaultImportFromModule:e=>null!=f(e),getLocalForNamespaceImportFromModule:S,hasLocalForNamespaceImportFromModule:e=>null!=S(e),getLocalForNamedImportPropertyNameFromModule:x,hasLocalForNamedImportPropertyNameFromModule:(e,t)=>null!=x(e,t),addLeadingStatements:(...e)=>{n.push(...e)},addTrailingStatements:(...e)=>{s.push(...e)},isIdentifierFree:I,getFreeIdentifier:(e,t=!1)=>{let r=0;if(I(e)&&!t)return u(e),e;for(;;){const t=e+"$"+r;if(I(t))return u(t),t;r++}},ignoreIdentifier:e=>d.delete(e),getModuleExportsForPath:t=>l.get(e.normalize(t)),addModuleExportsForPath:(t,r)=>l.set(e.normalize(t),r),get imports(){return[...o.entries()].filter((([,{noEmit:e}])=>!e)).map((([e])=>e))},get leadingStatements(){return n},get trailingStatements(){return s},get isDefaultExported(){return m},get exportedLocals(){return p}}})(),l={context:s,continuation:e=>b({...l,sourceFile:t,node:e}),childContinuation:e=>i.visitEachChild(e,(e=>{const r=b({...l,sourceFile:t,node:e});return w(r,i)?o.createNotEmittedStatement(e):r}),n)},c={context:s,continuation:e=>k({...c,sourceFile:t,node:e}),childContinuation:e=>i.visitEachChild(e,(e=>{const r=k({...c,sourceFile:t,node:e});return w(r,i)?o.createNotEmittedStatement(e):r}),n)};k({...c,sourceFile:t,node:t});let d=b({...l,sourceFile:t,node:t});const p=[...s.imports,...s.leadingStatements.filter(i.isImportDeclaration),...d.statements.filter(i.isImportDeclaration),...s.trailingStatements.filter(i.isImportDeclaration)],m=[...s.leadingStatements.filter((e=>i.isExportDeclaration(e)||i.isExportAssignment(e))),...d.statements.filter((e=>i.isExportDeclaration(e)||i.isExportAssignment(e))),...s.trailingStatements.filter((e=>i.isExportDeclaration(e)||i.isExportAssignment(e)))],u=[...s.leadingStatements.filter((e=>!p.includes(e)&&!m.includes(e))),...d.statements.filter((e=>!p.includes(e)&&!m.includes(e)&&e.kind!==i.SyntaxKind.NotEmittedStatement)),...s.trailingStatements.filter((e=>!p.includes(e)&&!m.includes(e)))];d=o.updateSourceFile(d,[...p,...u,...m],t.isDeclarationFile,t.referencedFiles,t.typeReferenceDirectives,t.hasNoDefaultLib,t.libReferenceDirectives);const E={hasDefaultExport:!1,namedExports:new Set};for(const e of d.statements)if(i.isExportDeclaration(e)&&null!=e.exportClause&&i.isNamedExports(e.exportClause))for(const t of e.exportClause.elements)E.namedExports.add(t.name.text);else if(i.isExportAssignment(e))E.hasDefaultExport=!0;else if(null!=e.modifiers&&e.modifiers.some((e=>e.kind===i.SyntaxKind.ExportKeyword)))if(e.modifiers.some((e=>e.kind===i.SyntaxKind.DefaultKeyword)))E.hasDefaultExport=!0;else if(i.isVariableStatement(e))for(const t of e.declarationList.declarations)for(const e of L(t.name,i))E.namedExports.add(e);else h(e,i)&&null!=e.name&&i.isIdentifier(e.name)&&E.namedExports.add(e.name.text);return s.addModuleExportsForPath(e.normalize(t.fileName),E),!s.onlyExports&&y(s.debug,t)&&null!=s.printer&&(s.logger.debug("===",e.native.normalize(t.fileName),"==="),s.logger.debug(s.printer.printFile(d)),s.logger.debug("EXPORTS:",s.exportedLocals)),{sourceFile:d,exports:E}}const W={statSync:a.statSync,lstatSync:a.lstatSync,readdirSync:a.readdirSync,readFileSync:a.readFileSync};function B(e){return{...e,safeReadFileSync:t=>{try{return e.readFileSync(t)}catch{return}},safeStatSync:t=>{try{return e.statSync(t)}catch{return}}}}a.mkdirSync,a.writeFileSync;class H{constructor(e){this.logLevel=e}info(...e){this.logLevel<1||console.log(...e)}verbose(...e){this.logLevel<2||console.log("[VERBOSE]",...e)}debug(...e){this.logLevel<3||console.log("[DEBUG]",...e)}warn(...e){console.log("(!)",...e)}}function V(e={}){return t=>{var r;const a=function({typescript:e=i,fileSystem:t=W,debug:r=!1,cwd:a=process.cwd(),preserveModuleSpecifiers:o="external",importAssertions:n=!0,logger:s=new H(!1!==r?3:0)}={}){return{typescript:e,fileSystem:t,debug:r,cwd:a,preserveModuleSpecifiers:o,importAssertions:n,logger:s}}(e),{fileSystem:o,typescript:n}=a,s={...a,transformationContext:t,factory:null!==(r=t.factory)&&void 0!==r?r:n,fileSystem:B(o),onlyExports:!1,resolveCache:new Map,printer:n.createPrinter()};return e=>U(e,s).sourceFile}}function G(e){return{before:[V(e)]}}export{G as cjsToEsm,V as cjsToEsmTransformer};